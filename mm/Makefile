CC =gcc # GNU C 鐠囶叀鈻堢紓鏍槯閸ｃ劊鈧拷
CFLAGS =-O -Wall -fstrength-reduce -fcombine-regs -fomit-frame-pointer \
-finline-functions -nostdinc -I../include
# C 缂傛牞鐦х粙瀣碍闁銆嶉妴锟�-Wall 閺勫墽銇氶幍鈧張澶屾畱鐠€锕€鎲℃穱鈩冧紖閿涳拷-O 娴兼ê瀵查柅澶愩€嶉敍灞肩喘閸栨牔鍞惍渚€鏆辨惔锕€鎷伴幍褑顢戦弮鍫曟？閿涳拷
# -fstrength-reduce 娴兼ê瀵插顏嗗箚閹笛嗩攽娴狅絿鐖滈敍灞惧笓闂勩倝鍣告径宥呭綁闁插骏绱�-fomit-frame-pointer 閻胶鏆愭穱婵嗙摠娑撳秴绻€鐟曪拷
# 閻ㄥ嫭顢嬮弸鑸靛瘹闁藉牞绱�-fcombine-regs 閸氬牆鑻熺€靛嫬鐡ㄩ崳顭掔礉閸戝繐鐨€靛嫬鐡ㄩ崳銊ц閻ㄥ嫪濞囬悽顭掔幢-finline-functions 鐏忓棙澧嶉張澶岀暆
# 閸楁洜鐓亸蹇曟畱閸戣姤鏆熸禒锝囩垳瀹撳苯鍙嗙拫鍐暏缁嬪绨稉顓ㄧ幢-nostdinc -I../include 娑撳秳濞囬悽銊╃帛鐠併倛鐭惧鍕厬閻ㄥ嫬瀵橀崥顐ｆ瀮娴犺绱濋懓锟�
# 娴ｈ法鏁ゆ潻娆撳櫡閹稿洤鐣鹃惄顔肩秿娑擃厾娈�(../include)閵嗭拷
AS =gas # GNU 閻ㄥ嫭鐪圭紓鏍柤鎼村繈鈧拷
AR =gar # GNU 閻ㄥ嫪绨╂潻娑樺煑閺傚洣娆㈡径鍕倞缁嬪绨敍宀€鏁ゆ禍搴″灡瀵ゆ亽鈧椒鎱ㄩ弨閫涗簰閸欏﹣绮犺ぐ鎺撱€傞弬鍥︽娑擃厽濞婇崣鏍ㄦ瀮娴犺翰鈧拷
LD =gld # GNU 閻ㄥ嫯绻涢幒銉р柤鎼村繈鈧拷
CPP =gcc -E -nostdinc -I../include
# C 閸撳秴顦╅悶鍡涒偓澶愩€嶉妴锟�-E 閸欘亣绻嶇悰瀛� 閸撳秴顦╅悶鍡礉鐎佃澧嶉張澶嬪瘹鐎规氨娈慍 缁嬪绨潻娑滎攽妫板嫬顦╅悶鍡楄嫙鐏忓棗顦╅悶鍡欑波閺嬫粏绶崙鍝勫煂閺嶅洤鍣潏锟�
# 閸戦缚顔曟径鍥ㄥ灗閹稿洤鐣鹃惃鍕翻閸戠儤鏋冩禒鏈佃厬閿涳拷-nostdinc -I../include 閸氬苯澧犻妴锟�

# 娑撳娼伴惃鍕潐閸掓瑦瀵氱粈绨僡ke 閸掆晝鏁ゆ稉瀣桨閻ㄥ嫬鎳℃禒銈呯殺閹碘偓閺堝娈�.c 閺傚洣娆㈢紓鏍槯閻㈢喐鍨�.s 濮瑰洨绱粙瀣碍閵嗗倽顕氱憴鍕灟閻ㄥ嫬鎳℃禒锟�
# 閹稿洣濞噂cc 闁插洨鏁FLAGS 閹碘偓閹稿洤鐣鹃惃鍕偓澶愩€嶇€电 娴狅絿鐖滅紓鏍槯閸氬簼绗夋潻娑滎攽濮瑰洨绱亸鍗炰粻濮濐澁绱�-S閿涘绱濇禒搴も偓灞奸獓閻㈢喍绗�
# 鏉堟挸鍙嗛惃鍕倗娑撶嫝 閺傚洣娆㈢€电懓绨查惃鍕湽缂傛牔鍞惍浣规瀮娴犺翰鈧倿绮拋銈嗗剰閸愬吀绗呴幍鈧禍褏鏁撻惃鍕湽缂傛牜鈻兼惔蹇旀瀮娴犺泛鎮曢弰顖氬斧C 閺傚洣娆㈤崥锟�
# 閸樼粯甯€.c 閼板苯濮炴稉锟�.s 閸氬海绱戦妴锟�-o 鐞涖劎銇氶崗璺烘倵閺勵垵绶崙鐑樻瀮娴犲墎娈戦崥宥囆為妴鍌氬従娑擄拷$*.s閿涘牊鍨�$@閿涘妲搁懛顏勫З閻╊喗鐖ｉ崣姗€鍣洪敍锟�
# $<娴狅綀銆冪粭顑跨娑擃亜鍘涢崘铏蒋娴犺绱濇潻娆撳櫡閸楄櫕妲哥粭锕€鎮庨弶鈥叉*.c 閻ㄥ嫭鏋冩禒韬测偓锟�

.c.o:
	$(CC) $(CFLAGS) \
	-c -o $*.o $<

# 娑撳娼扮憴鍕灟鐞涖劎銇氱亸鍡樺閺堬拷.s 濮瑰洨绱粙瀣碍閺傚洣娆㈢紓鏍槯閹达拷.o 閻╊喗鐖ｉ弬鍥︽閵嗭拷22 鐞涘本妲哥€圭偟骞囩拠銉︽惙娴ｆ粎娈戦崗铚傜秼閸涙垝鎶ら妴锟�
.s.o:
$(AS) -o $*.o $<
.c.s: # 缁鎶€娑撳﹪娼伴敍锟�*.c 閺傚洣娆�-??*.s 濮瑰洨绱粙瀣碍閺傚洣娆㈤妴鍌欑瑝鏉╂稖顢戞潻鐐村复閵嗭拷
$(CC) $(CFLAGS) \
-S -o $*.s $<

OBJS = memory.o page.o # 鐎规矮绠熼惄顔界垼閺傚洣娆㈤崣姗€鍣篛BJS閵嗭拷

all: mm.o

mm.o: $(OBJS) # 閸︺劍婀佹禍鍡楀帥閸愯櫕娼禒绂JS 閸氬簼濞囬悽銊ょ瑓闂堛垻娈戦崨鎴掓姢鏉╃偞甯撮幋鎰窗閺嶅檲m.o
$(LD) -r -o mm.o $(OBJS)

# 娑撳娼伴惃鍕潐閸掓瑧鏁ゆ禍搴㈢閻炲棗浼愭担婧库偓鍌氱秼閹笛嗩攽'make clean'閺冭绱濈亸鍙樼窗閹笛嗩攽26--27 鐞涘奔绗傞惃鍕嚒娴犮倧绱濋崢濠氭珟閹碘偓閺堝绱拠锟�
# 鏉╃偞甯撮悽鐔稿灇閻ㄥ嫭鏋冩禒韬测偓锟�'rm'閺勵垱鏋冩禒璺哄灩闂勩倕鎳℃禒銈忕礉闁銆�-f 閸氼偂绠熼弰顖氭嫹閻ｃ儰绗夌€涙ê婀惃鍕瀮娴犺绱濋獮鏈电瑬娑撳秵妯夌粈鍝勫灩闂勩倓淇婇幁顖樷偓锟�
clean:
rm -f core *.o *.a tmp_make
for i in *.c;do rm -f `basename $$i .c`.s;done

# 娑撳娼板妤冩窗閺嶅洦鍨ㄧ憴鍕灟閻€劋绨Λ鈧弻銉ユ倗閺傚洣娆㈡稊瀣？閻ㄥ嫪绶风挧鏍у彠缁眹鈧倹鏌熷▔鏇烆洤娑撳绱�
# 娴ｈ法鏁ょ€涙顑佹稉鑼椽鏉堟垹鈻兼惔寮抏d 鐎电瓊akefile 閺傚洣娆㈤敍鍫ｇ箹闁插苯宓嗛弰顖濆殰瀹告唻绱氭潻娑滎攽婢跺嫮鎮婇敍宀冪翻閸戣桨璐熼崚鐘绘珟Makefile
# 閺傚洣娆㈡稉锟�'### Dependencies'鐞涘苯鎮楅棃銏㈡畱閹碘偓閺堝顢戦敍鍫滅瑓闂堫澀绮�35 瀵偓婵娈戠悰宀嬬礆閿涘苯鑻熼悽鐔稿灇tmp_make
# 娑撳瓨妞傞弬鍥︽閿涳拷30 鐞涘瞼娈戞担婊呮暏閿涘鈧倻鍔ч崥搴☆嚠mm/閻╊喖缍嶆稉瀣畱濮ｅ繋绔存稉鐙� 閺傚洣娆㈤幍褑顢慻cc 妫板嫬顦╅悶鍡樻惙娴ｏ拷.
# -M 閺嶅洤绻旈崨濠呯様妫板嫬顦╅悶鍡欌柤鎼村繗绶崙鐑樺伎鏉╃増鐦℃稉顏嗘窗閺嶅洦鏋冩禒鍓佹祲閸忚櫕鈧呮畱鐟欏嫬鍨敍灞借嫙娑撴棁绻栨禍娑滎潐閸掓瑧顑侀崥鍧ke 鐠囶厽纭堕妴锟�
# 鐎甸€涚艾濮ｅ繋绔存稉顏呯爱閺傚洣娆㈤敍宀勵暕婢跺嫮鎮婄粙瀣碍鏉堟挸鍤稉鈧稉鐚癮ke 鐟欏嫬鍨敍灞藉従缂佹挻鐏夎ぐ銏犵础閺勵垳娴夋惔鏃€绨粙瀣碍閺傚洣娆㈤惃鍕窗閺嶏拷
# 閺傚洣娆㈤崥宥呭娑撳﹤鍙炬笟婵婄閸忓磭閮�--鐠囥儲绨弬鍥︽娑擃厼瀵橀崥顐ゆ畱閹碘偓閺堝銇旈弬鍥︽閸掓銆冮妴鍌涘Ω妫板嫬顦╅悶鍡欑波閺嬫粓鍏樺ǎ璇插閸掗澶嶉弮锟�
# 閺傚洣娆mp_make 娑擃叏绱濋悞璺烘倵鐏忓棜顕氭稉瀛樻閺傚洣娆㈡径宥呭煑閹存劖鏌婇惃鍑猘kefile 閺傚洣娆㈤妴锟�
# 
# $ make dep 娴兼艾鍨归梽锟� 閳ワ拷### Dependencies:閳ワ拷 閸氬孩澧嶉張澶屾畱閸愬懎顔愰敍宀€鍔ч崥搴ｆ晸閹存劖鏌婇惃鍕贩鐠ф牕鍙х化浼欑礉
# $ 閸滃苯澧犻棃銏㈡畱 makefile 閸氬牊鍨氭稉鈧稉顏呮煀閻拷 Makefile 閺傚洣娆�
dep:
sed '/\#\#\# Dependencies/q' < Makefile > tmp_make
(for i in *.c;do $(CPP) -M $$i;done) >> tmp_make
cp tmp_make Makefile

### Dependencies:
memory.o : memory.c ../include/signal.h ../include/sys/types.h \
../include/asm/system.h ../include/linux/sched.h ../include/linux/head.h \
../include/linux/fs.h ../include/linux/mm.h ../include/linux/kernel.h
